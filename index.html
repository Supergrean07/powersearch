<!DOCTYPE html>
<html>
<head>
    <title>Sports Card Power Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body class="d-flex flex-column align-items-center bg-light py-5">
    <div class="container bg-white p-5 rounded shadow">
        <h1 class="text-center text-primary mb-4">Sports Card Power Search</h1>
        <form onsubmit="searchSites(event)" class="mb-4">
            <div class="input-group mb-3">
                <input type="text" id="searchInput" class="form-control" placeholder="Enter search term">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
            <div class="text-muted mb-3">May contain affiliate links. Make sure your browser has enabled multiple new windows to open.</div>
            <div class="row">
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="ebay" name="marketplace" value="ebay" checked>
                        <label class="form-check-label" for="ebay">eBay</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="pwccWeekly" name="marketplace" value="pwccWeekly" checked>
                        <label class="form-check-label" for="pwccWeekly">PWCC Weekly Auction</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="pwccVault" name="marketplace" value="pwccVault" checked>
                        <label class="form-check-label" for="pwccVault">PWCC Vault Marketplace</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="myslabs" name="marketplace" value="myslabs" checked>
                        <label class="form-check-label" for="myslabs">MySlabs</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="cardhobby" name="marketplace" value="cardhobby" checked>
                        <label class="form-check-label" for="cardhobby">CardHobby</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="alt" name="marketplace" value="alt" checked>
                        <label class="form-check-label" for="alt">Alt</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="goldin" name="marketplace" value="goldin" checked>
                        <label class="form-check-label" for="goldin">Goldin</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="ha" name="marketplace" value="ha" checked>
                        <label class="form-check-label" for="ha">Heritage Auctions</label>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="comc" name="marketplace" value="comc" checked>
                        <label class="form-check-label" for="comc">COMC</label>
                    </div>
                </div>
            </div>
        </form>

        <div class="recent-searches">
            <h2>Recent Searches</h2>
            <div id="recentSearchesContainer" class="mb-3"></div>
            <div class="text-danger" id="clearButton" onclick="clearRecentSearches()" style="cursor: pointer; display: none;">Clear Recent Searches</div>
        </div>
    </div>

    <script>
        (function(apiKey){
            (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
            v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
                o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
                y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
                z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');
        })('bc4dbebc-2aed-41a5-7073-1fc30a74ed53');

        pendo.initialize({
            visitor: {
                id: '<visitor-id-goes-here>',
                email: '<email-goes-here>',
                firstName: '<first-name-goes-here>',
                lastName: '<last-name-goes-here>',
            },

            account: {
                id: '<account-id-goes-here>',
                accountName: '<account-name-goes-here>',
                payingStatus: '<paying-status-goes-here>',
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            displayRecentSearches();
        });

        function searchSites(event) {
            event.preventDefault();
            const searchTerm = document.getElementById('searchInput').value;
            if (searchTerm.trim() === "") return;
            
            saveSearchTerm(searchTerm); // Save the search term before performing the search
            
            const marketplaces = document.querySelectorAll('input[name="marketplace"]:checked');
            let windowRefs = JSON.parse(localStorage.getItem('windowRefs')) || {};

            marketplaces.forEach(marketplace => {
                let url;
                switch (marketplace.value) {
                    case 'ebay':
                        url = `https://www.ebay.com/sch/i.html?_from=R40&_trksid=p4432023.m570.l1312&_nkw=${encodeURIComponent(searchTerm)}&_sacat=0`;
                        break;
                    case 'pwccWeekly':
                        url = `https://www.pwccmarketplace.com/weekly-auction/?q=${encodeURIComponent(searchTerm)}`;
                        break;
                    case 'pwccVault':
                        url = `https://www.pwccmarketplace.com/vault-marketplace/?q=${encodeURIComponent(searchTerm)}`;
                        break;
                    case 'myslabs':
                        url = `https://www.myslabs.com/search/slabs/?publish_type=0&owner=&q=${encodeURIComponent(searchTerm)}&o=created_desc/`;
                        break;
                    case 'cardhobby':
                        url = `https://cardhobby.com/#/market?type=like&key=${encodeURIComponent(searchTerm)}`;
                        break;
                    case 'alt':
                        url = `https://app.alt.xyz/browse?query=${encodeURIComponent(searchTerm)}&sortBy=newest_first`;
                        break;
                    case 'goldin':
                        url = `https://goldin.co/buy/?search=${encodeURIComponent(searchTerm)}&sort=Ending_Soonest`;
                        break;
                    case 'ha':
                        url = `https://www.ha.com/c/search/results.zx?term=${encodeURIComponent(searchTerm)}&ic=homepage-search-A-K-071316`;
                        break;
                    case 'comc':
                        url = `https://www.comc.com/Cards,=${encodeURIComponent(searchTerm)}`;
                        break;
                }

                if (windowRefs[marketplace.value] && !windowRefs[marketplace.value].closed) {
                    windowRefs[marketplace.value].location.href = url;
                } else {
                    windowRefs[marketplace.value] = window.open(url, marketplace.value);
                }
            });

            localStorage.setItem('windowRefs', JSON.stringify(windowRefs));
            displayRecentSearches(); // Update the display of recent searches
        }

        function saveSearchTerm(searchTerm) {
            let recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
            if (!recentSearches.includes(searchTerm)) {
                recentSearches.unshift(searchTerm);
                if (recentSearches.length > 5) {
                    recentSearches.pop();
                }
                localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
            }
        }

        function displayRecentSearches() {
            const recentSearchesContainer = document.getElementById('recentSearchesContainer');
            const clearButton = document.getElementById('clearButton');
            recentSearchesContainer.innerHTML = '';
            const recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
            if (recentSearches.length > 0) {
                recentSearches.forEach(searchTerm => {
                    const searchElement = document.createElement('div');
                    searchElement.className = 'recent-search';
                    searchElement.textContent = searchTerm;
                    searchElement.onclick = () => {
                        document.getElementById('searchInput').value = searchTerm;
                        searchSites(new Event('submit'));
                    };
                    recentSearchesContainer.appendChild(searchElement);
                });
                clearButton.style.display = 'block'; // Show the clear button
            } else {
                clearButton.style.display = 'none'; // Hide the clear button
            }
        }

        function clearRecentSearches() {
            localStorage.removeItem('recentSearches');
            displayRecentSearches();
        }
    </script>

    <script>
        window.embeddedChatbotConfig = {
            chatbotId: "9y5h4sWRukeE6UiZkTZqf",
            domain: "www.chatbase.co"
        }
    </script>
    <script
        src="https://www.chatbase.co/embed.min.js"
        chatbotId="9y5h4sWRukeE6UiZkTZqf"
        domain="www.chatbase.co"
        defer>
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
